<!DOCTYPE html>

<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description"
    content="Go Micro is a framework for microservices development">
<meta name="keywords" content="go-micro,  go-micro">


<title>Go Micro | Micro</title>


<link rel="stylesheet" href="/docs/css/syntax.css">
<link rel="stylesheet" type="text/css"
    href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">


<link rel="stylesheet" href="/docs/css/customstyles.css?v=0">


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="/docs/js/jquery.navgoco.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="/docs/js/toc.js"></script>
<script src="/docs/js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="docs" href="https://micro.mu/docsfeed.xml">

    <script>
        $(document).ready(function () {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function (e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function (e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });
    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>

<body>
    <!-- Navigation -->
<div class="container">
	<nav class="navbar">
	    
	    <a class="navbar-brand" href="index.html"><span class="projectTitle"> Micro</span></a>
	    

	    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse-1">
		<span class="sr-only">Toggle navigation</span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
	    </button>

        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">English<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/docs/index.html">English</a></li>
                        
                        
                        
                        <li><a href="/docs/cn/index.html">中文</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
            </ul>
        </div>
    </nav>
</div>

    <!-- Page Content -->
    <div class="container">
        <div class="col-lg-12">&nbsp;</div>
        <!-- Content Row -->
        <div class="row">
            <!-- Sidebar Column -->
            <div class="col-md-3">

                







<ul id="mysidebar" class="nav list-group">
    
    
    
        
    
    <li class="list-group-item">
        <a href="#" class="title">Overview</a>
        <ul>
            
            
            
            <li><a href="/docs/index.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="/docs/faq.html">FAQ</a></li>
            
            
            
            
            
            
            <li><a href="/docs/features.html">Features</a></li>
            
            
            
            
            
            
            <li><a href="/docs/goals.html">Goals</a></li>
            
            
            
            
            
            
            <li><a href="/docs/users.html">Users</a></li>
            
            
            
            
        </ul>
        
        
    
    <li class="list-group-item">
        <a href="#" class="title">Framework</a>
        <ul>
            
            
            
            <li><a href="/docs/framework.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="/docs/go-micro-internals.html">Internals</a></li>
            
            
            
            
            
            
            <li><a href="/docs/go-api.html">API Handlers</a></li>
            
            
            
            
            
            
            <li><a href="/docs/go-config.html">Dynamic Config</a></li>
            
            
            
            
            
            
            <li><a href="/docs/go-grpc.html">gRPC Service</a></li>
            
            
            
            
            
            
            <li><a href="/docs/go-web.html">Web Service</a></li>
            
            
            
            
        </ul>
        
        
    
    <li class="list-group-item">
        <a href="#" class="title">Runtime</a>
        <ul>
            
            
            
            <li><a href="/docs/runtime.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="/docs/architecture.html">Architecture</a></li>
            
            
            
            
            
            
            <li><a href="/docs/api.html">API Gateway</a></li>
            
            
            
            
            
            
            <li><a href="/docs/web.html">Web Dashboard</a></li>
            
            
            
            
            
            
            <li><a href="/docs/proxy.html">Service Proxy</a></li>
            
            
            
            
            
            
            <li><a href="/docs/health.html">Service Health</a></li>
            
            
            
            
            
            
            <li><a href="/docs/service-network.html">Service Network</a></li>
            
            
            
            
            
            
            <li><a href="/docs/tunnel.html">Service Tunnel</a></li>
            
            
            
            
            
            
            <li><a href="/docs/cli.html">Command Line</a></li>
            
            
            
            
            
            
            <li><a href="/docs/bot.html">Slack Bot</a></li>
            
            
            
            
            
            
            <li><a href="/docs/new.html">New Template</a></li>
            
            
            
            
        </ul>
        
        
    
    <li class="list-group-item">
        <a href="#" class="title">Network</a>
        <ul>
            
            
            
            <li><a href="/docs/network.html">Overview</a></li>
            
            
            
            
        </ul>
        
        
    
    <li class="list-group-item">
        <a href="#" class="title">Deployment</a>
        <ul>
            
            
            
            <li><a href="/docs/deploy-local.html">Local</a></li>
            
            
            
            
            
            
            <li><a href="/docs/deploy-docker.html">Docker</a></li>
            
            
            
            
            
            
            <li><a href="/docs/deploy-kubernetes.html">Kubernetes</a></li>
            
            
            
            
        </ul>
        
        
    
    <li class="list-group-item">
        <a href="#" class="title">Guides</a>
        <ul>
            
            
            
            <li><a href="/docs/debugging.html">Debugging</a></li>
            
            
            
            
            
            
            <li><a href="/docs/installation.html">Installation</a></li>
            
            
            
            
            
            
            <li><a href="/docs/writing-a-go-service.html">Writing a Go Service</a></li>
            
            
            
            
            
            
            <li><a href="/docs/micro-service.html">Anything as a Service</a></li>
            
            
            
            
            
            
            <li><a href="/docs/fault-tolerance.html">Fault Tolerance</a></li>
            
            
            
            
        </ul>
        
        
    
    <li class="list-group-item">
        <a href="#" class="title">Plugins</a>
        <ul>
            
            
            
            <li><a href="/docs/plugins.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="/docs/plugins-framework.html">Framework</a></li>
            
            
            
            
            
            
            <li><a href="/docs/plugins-runtime.html">Runtime</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

                <!-- Content Column -->
                <div class="col-md-9">
                    <div class="post-header">
   <h1 class="post-title-main">Go Micro</h1>
</div>



<div class="post-content">

   
    <div class="summary">Go Micro is a framework for microservices development</div>
   

    

  <h1 id="overview">Overview</h1>

<p>Go Micro provides the core requirements for distributed systems development including RPC and Event driven communication. 
The micro philosophy is sane defaults with a pluggable architecture. We provide defaults to get you started quickly but everything can be easily swapped out.</p>

<h2 id="features">Features</h2>

<p>Go Micro abstracts away the details of distributed systems. Here are the main features.</p>

<ul>
  <li>
    <p><strong>Service Discovery</strong> - Automatic service registration and name resolution. Service discovery is at the core of micro service
development. When service A needs to speak to service B it needs the location of that service. The default discovery mechanism is
multicast DNS (mdns), a zeroconf system.</p>
  </li>
  <li>
    <p><strong>Load Balancing</strong> - Client side load balancing built on service discovery. Once we have the addresses of any number of instances 
of a service we now need a way to decide which node to route to. We use random hashed load balancing to provide even distribution 
across the services and retry a different node if there’s a problem.</p>
  </li>
  <li>
    <p><strong>Message Encoding</strong> - Dynamic message encoding based on content-type. The client and server will use codecs along with content-type 
to seamlessly encode and decode Go types for you. Any variety of messages could be encoded and sent from different clients. The client 
and server handle this by default. This includes proto-rpc and json-rpc by default.</p>
  </li>
  <li>
    <p><strong>Request/Response</strong> - RPC based request/response with support for bidirectional streaming. We provide an abstraction for synchronous 
communication. A request made to a service will be automatically resolved, load balanced, dialled and streamed. The default 
transport is http/1.1 or http2 when tls is enabled.</p>
  </li>
  <li>
    <p><strong>Async Messaging</strong> - PubSub is built in as a first class citizen for asynchronous communication and event driven architectures. 
Event notifications are a core pattern in micro service development. The default messaging is point-to-point http/1.1 or http2 when tls 
is enabled.</p>
  </li>
  <li>
    <p><strong>Pluggable Interfaces</strong> - Go Micro makes use of Go interfaces for each distributed system abstraction. Because of this these interfaces 
are pluggable and allows Go Micro to be runtime agnostic. You can plugin any underlying technology. Find plugins in 
<a href="https://github.com/micro/go-plugins">github.com/micro/go-plugins</a>.</p>
  </li>
</ul>

<h2 id="getting-started">Getting started</h2>

<ul>
  <li><a href="#install-protobuf">Install Protobuf</a></li>
  <li><a href="#service-discovery">Service Discovery</a></li>
  <li><a href="#writing-a-service">Writing a Service</a></li>
  <li><a href="#publish--subscribe">Publish &amp; Subscribe</a></li>
  <li><a href="#plugins">Plugins</a></li>
  <li><a href="#wrappers">Wrappers</a></li>
  <li><a href="#examples">Examples</a></li>
</ul>

<h2 id="install-protobuf">Install Protobuf</h2>

<p>Protobuf is required for code generation</p>

<p>You’ll need to install:</p>

<ul>
  <li><a href="https://github.com/micro/protoc-gen-micro">protoc-gen-micro</a></li>
</ul>

<h2 id="service-discovery">Service Discovery</h2>

<p>Service discovery is used to resolve service names to addresses.</p>

<p>The default discovery system is multicast DNS which requires zeroconf. If you want something more resilient and multi-host then use consul.</p>

<h3 id="etcd">Etcd</h3>

<p><a href="https://github.com/etcd-io/etcd">Etcd</a> can be used as an alternative service discovery system.</p>

<ul>
  <li>Download and run <a href="https://github.com/etcd-io/etcd">etcd</a></li>
  <li>Pass <code class="highlighter-rouge">--registry=etcd</code> to any command or the enviroment variable <code class="highlighter-rouge">MICRO_REGISTRY=etcd</code></li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MICRO_REGISTRY=etcd go run main.go
</code></pre></div></div>

<p>Discovery is pluggable. Find plugins for consul, kubernetes, zookeeper and more in the <a href="https://github.com/micro/go-plugins">micro/go-plugins</a> repo.</p>

<h2 id="writing-a-service">Writing a service</h2>

<p>This is a simple greeter RPC service example</p>

<p>Find this example at <a href="https://github.com/micro/examples/tree/master/service">examples/service</a>.</p>

<h3 id="create-service-proto">Create service proto</h3>

<p>One of the key requirements of microservices is strongly defined interfaces. Micro uses protobuf to achieve this.</p>

<p>Here we define the Greeter handler with the method Hello. It takes a HelloRequest and HelloResponse both with one string arguments.</p>

<div class="language-proto highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">syntax</span> <span class="o">=</span> <span class="s">"proto3"</span><span class="p">;</span>

<span class="kd">service</span> <span class="n">Greeter</span> <span class="p">{</span>
	<span class="k">rpc</span> <span class="n">Hello</span><span class="p">(</span><span class="n">HelloRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">HelloResponse</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">HelloRequest</span> <span class="p">{</span>
	<span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">HelloResponse</span> <span class="p">{</span>
	<span class="kt">string</span> <span class="na">greeting</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="generate-the-proto">Generate the proto</h3>

<p>After writing the proto definition we must compile it using protoc with the micro plugin.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>protoc <span class="nt">--proto_path</span><span class="o">=</span><span class="nv">$GOPATH</span>/src:. <span class="nt">--micro_out</span><span class="o">=</span><span class="nb">.</span> <span class="nt">--go_out</span><span class="o">=</span><span class="nb">.</span> path/to/greeter.proto
</code></pre></div></div>

<h3 id="write-the-service">Write the service</h3>

<p>Below is the code for the greeter service.</p>

<p>It does the following:</p>

<ol>
  <li>Implements the interface defined for the Greeter handler</li>
  <li>Initialises a micro.Service</li>
  <li>Registers the Greeter handler</li>
  <li>Runs the service</li>
</ol>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
	</span><span class="s">"context"</span><span class="x">
	</span><span class="s">"fmt"</span><span class="x">

	</span><span class="n">micro</span><span class="x"> </span><span class="s">"github.com/micro/go-micro"</span><span class="x">
	</span><span class="n">proto</span><span class="x"> </span><span class="s">"github.com/micro/examples/service/proto"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">Greeter</span><span class="x"> </span><span class="k">struct</span><span class="p">{}</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">g</span><span class="x"> </span><span class="o">*</span><span class="n">Greeter</span><span class="p">)</span><span class="x"> </span><span class="n">Hello</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">req</span><span class="x"> </span><span class="o">*</span><span class="n">proto</span><span class="o">.</span><span class="n">HelloRequest</span><span class="p">,</span><span class="x"> </span><span class="n">rsp</span><span class="x"> </span><span class="o">*</span><span class="n">proto</span><span class="o">.</span><span class="n">HelloResponse</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">rsp</span><span class="o">.</span><span class="n">Greeting</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"Hello "</span><span class="x"> </span><span class="o">+</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">Name</span><span class="x">
	</span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="c">// Create a new service. Optionally include some options here.</span><span class="x">
	</span><span class="n">service</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">micro</span><span class="o">.</span><span class="n">NewService</span><span class="p">(</span><span class="x">
		</span><span class="n">micro</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s">"greeter"</span><span class="p">),</span><span class="x">
	</span><span class="p">)</span><span class="x">

	</span><span class="c">// Init will parse the command line flags.</span><span class="x">
	</span><span class="n">service</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span><span class="x">

	</span><span class="c">// Register handler</span><span class="x">
	</span><span class="n">proto</span><span class="o">.</span><span class="n">RegisterGreeterHandler</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">Server</span><span class="p">(),</span><span class="x"> </span><span class="nb">new</span><span class="p">(</span><span class="n">Greeter</span><span class="p">))</span><span class="x">

	</span><span class="c">// Run the server</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">service</span><span class="o">.</span><span class="n">Run</span><span class="p">();</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
	</span><span class="p">}</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<h3 id="run-service">Run service</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go run examples/service/main.go
</code></pre></div></div>

<p>Output</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2016/03/14 10:59:14 Listening on [::]:50137
2016/03/14 10:59:14 Broker Listening on [::]:50138
2016/03/14 10:59:14 Registering node: greeter-ca62b017-e9d3-11e5-9bbb-68a86d0d36b6
</code></pre></div></div>

<h3 id="define-a-client">Define a client</h3>

<p>Below is the client code to query the greeter service.</p>

<p>The generated proto includes a greeter client to reduce boilerplate code.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
	</span><span class="s">"context"</span><span class="x">
	</span><span class="s">"fmt"</span><span class="x">

	</span><span class="n">micro</span><span class="x"> </span><span class="s">"github.com/micro/go-micro"</span><span class="x">
	</span><span class="n">proto</span><span class="x"> </span><span class="s">"github.com/micro/examples/service/proto"</span><span class="x">
</span><span class="p">)</span><span class="x">


</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="c">// Create a new service. Optionally include some options here.</span><span class="x">
	</span><span class="n">service</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">micro</span><span class="o">.</span><span class="n">NewService</span><span class="p">(</span><span class="n">micro</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s">"greeter.client"</span><span class="p">))</span><span class="x">
	</span><span class="n">service</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span><span class="x">

	</span><span class="c">// Create new greeter client</span><span class="x">
	</span><span class="n">greeter</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">proto</span><span class="o">.</span><span class="n">NewGreeterService</span><span class="p">(</span><span class="s">"greeter"</span><span class="p">,</span><span class="x"> </span><span class="n">service</span><span class="o">.</span><span class="n">Client</span><span class="p">())</span><span class="x">

	</span><span class="c">// Call the greeter</span><span class="x">
	</span><span class="n">rsp</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">greeter</span><span class="o">.</span><span class="n">Hello</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">TODO</span><span class="p">(),</span><span class="x"> </span><span class="o">&amp;</span><span class="n">proto</span><span class="o">.</span><span class="n">HelloRequest</span><span class="p">{</span><span class="n">Name</span><span class="o">:</span><span class="x"> </span><span class="s">"John"</span><span class="p">})</span><span class="x">
	</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
	</span><span class="p">}</span><span class="x">

	</span><span class="c">// Print response</span><span class="x">
	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">rsp</span><span class="o">.</span><span class="n">Greeting</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<h3 id="run-the-client">Run the client</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go run client.go
</code></pre></div></div>

<p>Output</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello John
</code></pre></div></div>

<h2 id="publish--subscribe">Publish &amp; Subscribe</h2>

<p>Go-micro has a built in message broker interface for event driven architectures.</p>

<p>PubSub operates on the same protobuf generated messages as RPC. They are encoded/decoded automatically and sent via the broker. 
By default go-micro includes a point-to-point http broker but this can be swapped out via go-plugins.</p>

<h3 id="publish">Publish</h3>

<p>Create a new publisher with a <code class="highlighter-rouge">topic</code> name and service client</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">micro</span><span class="o">.</span><span class="n">NewPublisher</span><span class="p">(</span><span class="s">"events"</span><span class="p">,</span><span class="x"> </span><span class="n">service</span><span class="o">.</span><span class="n">Client</span><span class="p">())</span><span class="x">
</span></code></pre></div></div>

<p>Publish a proto message</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span><span class="o">.</span><span class="n">Publish</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">TODO</span><span class="p">(),</span><span class="x"> </span><span class="o">&amp;</span><span class="n">proto</span><span class="o">.</span><span class="n">Event</span><span class="p">{</span><span class="n">Name</span><span class="o">:</span><span class="x"> </span><span class="s">"event"</span><span class="p">})</span><span class="x">
</span></code></pre></div></div>

<h3 id="subscribe">Subscribe</h3>

<p>Create a message handler. It’s signature should be <code class="highlighter-rouge">func(context.Context, v interface{}) error</code>.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span><span class="x"> </span><span class="n">ProcessEvent</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">event</span><span class="x"> </span><span class="o">*</span><span class="n">proto</span><span class="o">.</span><span class="n">Event</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Got event %+v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">event</span><span class="p">)</span><span class="x">
	</span><span class="k">return</span><span class="x"> </span><span class="no">nil</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>Register the message handler with a <code class="highlighter-rouge">topic</code></p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">micro</span><span class="o">.</span><span class="n">RegisterSubscriber</span><span class="p">(</span><span class="s">"events"</span><span class="p">,</span><span class="x"> </span><span class="n">ProcessEvent</span><span class="p">)</span><span class="x">
</span></code></pre></div></div>

<p>See <a href="https://github.com/micro/examples/tree/master/pubsub">examples/pubsub</a> for a complete example.</p>

<h2 id="plugins">Plugins</h2>

<p>By default go-micro only provides a few implementation of each interface at the core but it’s completely pluggable. There’s already dozens of plugins which are available at <a href="https://github.com/micro/go-plugins">github.com/micro/go-plugins</a>. Contributions are welcome!</p>

<h3 id="build-with-plugins">Build with plugins</h3>

<p>If you want to integrate plugins simply link them in a separate file and rebuild</p>

<p>Create a plugins.go file</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
        </span><span class="c">// etcd v3 registry</span><span class="x">
        </span><span class="n">_</span><span class="x"> </span><span class="s">"github.com/micro/go-plugins/registry/etcdv3"</span><span class="x">
        </span><span class="c">// nats transport</span><span class="x">
        </span><span class="n">_</span><span class="x"> </span><span class="s">"github.com/micro/go-plugins/transport/nats"</span><span class="x">
        </span><span class="c">// kafka broker</span><span class="x">
        </span><span class="n">_</span><span class="x"> </span><span class="s">"github.com/micro/go-plugins/broker/kafka"</span><span class="x">
</span><span class="p">)</span><span class="x">
</span></code></pre></div></div>

<p>Build binary</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// For <span class="nb">local </span>use
go build <span class="nt">-i</span> <span class="nt">-o</span> service ./main.go ./plugins.go
</code></pre></div></div>

<p>Flag usage of plugins</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>service <span class="nt">--registry</span><span class="o">=</span>etcdv3 <span class="nt">--transport</span><span class="o">=</span>nats <span class="nt">--broker</span><span class="o">=</span>kafka
</code></pre></div></div>

<h3 id="plugin-as-option">Plugin as option</h3>

<p>Alternatively you can set the plugin as an option to a service</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="x">
</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
        </span><span class="s">"github.com/micro/go-micro"</span><span class="x"> 
        </span><span class="c">// etcd v3 registry</span><span class="x">
        </span><span class="s">"github.com/micro/go-plugins/registry/etcdv3"</span><span class="x">
        </span><span class="c">// nats transport</span><span class="x">
        </span><span class="s">"github.com/micro/go-plugins/transport/nats"</span><span class="x">
        </span><span class="c">// kafka broker</span><span class="x">
        </span><span class="s">"github.com/micro/go-plugins/broker/kafka"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">registry</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">etcdv3</span><span class="o">.</span><span class="n">NewRegistry</span><span class="p">()</span><span class="x">
	</span><span class="n">broker</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">kafka</span><span class="o">.</span><span class="n">NewBroker</span><span class="p">()</span><span class="x">
	</span><span class="n">transport</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">nats</span><span class="o">.</span><span class="n">NewTransport</span><span class="p">()</span><span class="x">

        </span><span class="n">service</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">micro</span><span class="o">.</span><span class="n">NewService</span><span class="p">(</span><span class="x">
                </span><span class="n">micro</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s">"greeter"</span><span class="p">),</span><span class="x">
                </span><span class="n">micro</span><span class="o">.</span><span class="n">Registry</span><span class="p">(</span><span class="n">registry</span><span class="p">),</span><span class="x">
                </span><span class="n">micro</span><span class="o">.</span><span class="n">Broker</span><span class="p">(</span><span class="n">broker</span><span class="p">),</span><span class="x">
                </span><span class="n">micro</span><span class="o">.</span><span class="n">Transport</span><span class="p">(</span><span class="n">transport</span><span class="p">),</span><span class="x">
        </span><span class="p">)</span><span class="x">

	</span><span class="n">service</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span><span class="x">
	</span><span class="n">service</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<h3 id="write-plugins">Write plugins</h3>

<p>Plugins are a concept built on Go’s interface. Each package maintains a high level interface abstraction. 
Simply implement the interface and pass it in as an option to the service.</p>

<p>The service discovery interface is called <a href="https://godoc.org/github.com/micro/go-micro/registry#Registry">Registry</a>. 
Anything which implements this interface can be used as a registry. The same applies to the other packages.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span><span class="x"> </span><span class="n">Registry</span><span class="x"> </span><span class="k">interface</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="n">Register</span><span class="p">(</span><span class="o">*</span><span class="n">Service</span><span class="p">,</span><span class="x"> </span><span class="o">...</span><span class="n">RegisterOption</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x">
    </span><span class="n">Deregister</span><span class="p">(</span><span class="o">*</span><span class="n">Service</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x">
    </span><span class="n">GetService</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="x"> </span><span class="p">([]</span><span class="o">*</span><span class="n">Service</span><span class="p">,</span><span class="x"> </span><span class="kt">error</span><span class="p">)</span><span class="x">
    </span><span class="n">ListServices</span><span class="p">()</span><span class="x"> </span><span class="p">([]</span><span class="o">*</span><span class="n">Service</span><span class="p">,</span><span class="x"> </span><span class="kt">error</span><span class="p">)</span><span class="x">
    </span><span class="n">Watch</span><span class="p">()</span><span class="x"> </span><span class="p">(</span><span class="n">Watcher</span><span class="p">,</span><span class="x"> </span><span class="kt">error</span><span class="p">)</span><span class="x">
    </span><span class="n">String</span><span class="p">()</span><span class="x"> </span><span class="kt">string</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>Browse <a href="https://github.com/micro/go-plugins">go-plugins</a> to get a better idea of implementation details.</p>

<h2 id="wrappers">Wrappers</h2>

<p>Go-micro includes the notion of middleware as wrappers. The client or handlers can be wrapped using the decorator pattern.</p>

<h3 id="handler">Handler</h3>

<p>Here’s an example service handler wrapper which logs the incoming request</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// implements the server.HandlerWrapper</span><span class="x">
</span><span class="k">func</span><span class="x"> </span><span class="n">logWrapper</span><span class="p">(</span><span class="n">fn</span><span class="x"> </span><span class="n">server</span><span class="o">.</span><span class="n">HandlerFunc</span><span class="p">)</span><span class="x"> </span><span class="n">server</span><span class="o">.</span><span class="n">HandlerFunc</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="k">return</span><span class="x"> </span><span class="k">func</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">req</span><span class="x"> </span><span class="n">server</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span><span class="x"> </span><span class="n">rsp</span><span class="x"> </span><span class="k">interface</span><span class="p">{})</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
		</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"[%v] server request: %s"</span><span class="p">,</span><span class="x"> </span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">(),</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">Endpoint</span><span class="p">())</span><span class="x">
		</span><span class="k">return</span><span class="x"> </span><span class="n">fn</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="x"> </span><span class="n">req</span><span class="p">,</span><span class="x"> </span><span class="n">rsp</span><span class="p">)</span><span class="x">
	</span><span class="p">}</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>It can be initialised when creating the service</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">service</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">micro</span><span class="o">.</span><span class="n">NewService</span><span class="p">(</span><span class="x">
	</span><span class="n">micro</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s">"greeter"</span><span class="p">),</span><span class="x">
	</span><span class="c">// wrap the handler</span><span class="x">
	</span><span class="n">micro</span><span class="o">.</span><span class="n">WrapHandler</span><span class="p">(</span><span class="n">logWrapper</span><span class="p">),</span><span class="x">
</span><span class="p">)</span><span class="x">
</span></code></pre></div></div>

<h3 id="client">Client</h3>

<p>Here’s an example of a client wrapper which logs requests made</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span><span class="x"> </span><span class="n">logWrapper</span><span class="x"> </span><span class="k">struct</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">client</span><span class="o">.</span><span class="n">Client</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="p">(</span><span class="n">l</span><span class="x"> </span><span class="o">*</span><span class="n">logWrapper</span><span class="p">)</span><span class="x"> </span><span class="n">Call</span><span class="p">(</span><span class="n">ctx</span><span class="x"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="x"> </span><span class="n">req</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span><span class="x"> </span><span class="n">rsp</span><span class="x"> </span><span class="k">interface</span><span class="p">{},</span><span class="x"> </span><span class="n">opts</span><span class="x"> </span><span class="o">...</span><span class="n">client</span><span class="o">.</span><span class="n">CallOption</span><span class="p">)</span><span class="x"> </span><span class="kt">error</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"[wrapper] client request to service: %s endpoint: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">Service</span><span class="p">(),</span><span class="x"> </span><span class="n">req</span><span class="o">.</span><span class="n">Endpoint</span><span class="p">())</span><span class="x">
	</span><span class="k">return</span><span class="x"> </span><span class="n">l</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="x"> </span><span class="n">req</span><span class="p">,</span><span class="x"> </span><span class="n">rsp</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">

</span><span class="c">// implements client.Wrapper as logWrapper</span><span class="x">
</span><span class="k">func</span><span class="x"> </span><span class="n">logWrap</span><span class="p">(</span><span class="n">c</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">Client</span><span class="p">)</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">Client</span><span class="x"> </span><span class="p">{</span><span class="x">
	</span><span class="k">return</span><span class="x"> </span><span class="o">&amp;</span><span class="n">logWrapper</span><span class="p">{</span><span class="n">c</span><span class="p">}</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre></div></div>

<p>It can be initialised when creating the service</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">service</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">micro</span><span class="o">.</span><span class="n">NewService</span><span class="p">(</span><span class="x">
	</span><span class="n">micro</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s">"greeter"</span><span class="p">),</span><span class="x">
	</span><span class="c">// wrap the client</span><span class="x">
	</span><span class="n">micro</span><span class="o">.</span><span class="n">WrapClient</span><span class="p">(</span><span class="n">logWrap</span><span class="p">),</span><span class="x">
</span><span class="p">)</span><span class="x">
</span></code></pre></div></div>

<h2 id="examples">Examples</h2>

<p>An example service can be found in <a href="https://github.com/micro/examples/tree/master/service"><strong>examples/service</strong></a> and function in <a href="https://github.com/micro/examples/tree/master/function"><strong>examples/function</strong></a>.</p>

<p>The <a href="https://github.com/micro/examples"><strong>examples</strong></a> directory contains examples for using things such as middleware/wrappers, selector filters, pub/sub, grpc, plugins and much more. For the complete greeter example look at <a href="https://github.com/micro/examples/tree/master/greeter"><strong>examples/greeter</strong></a>. Other examples can be found throughout the GitHub repository.</p>

<p>Watch the <a href="https://www.youtube.com/watch?v=xspaDovwk34">Golang UK Conf 2016</a> video for a high level overview.</p>



<!--
    <div class="tags">
        
        
        
        
        
        
    </div>
-->
    

</div>

<hr class="faded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy; 2019 Micro Services, Inc.<br />
 Last generated: Nov 13, 2019 <br />
                </div>
            </div>
</footer>


                </div>
                <!-- /.row -->
            </div>
            <!-- /.container -->
        </div>
    </div>
</body>

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-70478210-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>



</html>